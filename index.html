<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Victambo 3D - High Brightness</title>
    <style>
        /* Est√©tica en Blanco y Gris */
        body { margin: 0; overflow: hidden; background: #ffffff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #ui { position: fixed; top: 20px; left: 20px; color: #333; z-index: 10; pointer-events: none; background: rgba(255,255,255,0.9); padding: 15px; border-radius: 12px; border: 2px solid #ddd; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        #keys-ui { font-size: 20px; color: #555; font-weight: bold; }
        #radar { font-size: 16px; color: #ff0000; margin-top: 8px; display: none; text-transform: uppercase; letter-spacing: 1px; }
        
        /* Controles Estilo Minimalista */
        #joy-container { position: fixed; bottom: 40px; left: 40px; width: 110px; height: 110px; background: rgba(0,0,0,0.05); border-radius: 50%; z-index: 20; border: 2px solid #ccc; }
        #joy-stick { position: absolute; top: 30px; left: 30px; width: 50px; height: 50px; background: #999; border-radius: 50%; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        
        #btn-action { position: fixed; bottom: 50px; right: 40px; width: 85px; height: 85px; background: #eeeeee; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #333; font-size: 35px; border: 3px solid #bbb; z-index: 20; cursor: pointer; transition: transform 0.1s; }
        #btn-action:active { transform: scale(0.9); }
        
        #start-screen { position: fixed; inset: 0; background: #ffffff; display: flex; align-items: center; justify-content: center; z-index: 200; color: #333; cursor: pointer; text-align: center; flex-direction: column; }
        #overlay { position: fixed; inset: 0; background: rgba(255,255,255,0.95); display: flex; align-items: center; justify-content: center; color: #ff0000; font-size: 40px; font-weight: bold; z-index: 300; display: none; text-align: center; }
    </style>
</head>
<body>

<div id="start-screen">
    <h1 style="font-size: 40px; margin-bottom: 10px;">V√çCTOR MENDIVIL</h1>
    <p style="font-size: 18px; color: #777;">TOCA PARA ENTRAR A LA CASA (BLANCO & GRIS)</p>
    <p style="font-size: 14px; margin-top: 20px; color: #999;">M√∫sica: Orula</p>
</div>

<div id="ui">
    <div id="keys-ui">üîë LLAVES: <span id="count">0</span> / 5</div>
    <div id="floor-ui" style="font-size: 14px; color: #888;">NIVEL: PLANTA BAJA</div>
    <div id="radar">‚ö†Ô∏è ORULA INTENSIFIC√ÅNDOSE ‚ö†Ô∏è</div>
</div>

<div id="joy-container"><div id="joy-stick"></div></div>
<div id="btn-action">üîë</div>
<div id="overlay">V√çCTOR TE ATRAP√ì</div>

<audio id="orula-song" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
</audio>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
let scene, camera, renderer, player, monster, orulaAudio;
let keys = [], keysCollected = 0;
let moveForward = 0, moveSide = 0;
let isGameOver = false;

// Velocidades ajustadas (Jugador m√°s controlable)
const PLAYER_SPEED = 0.11;
const MONSTER_SPEED = 0.09;
const FLOORS = { basement: -10, ground: 0, attic: 10 };

document.getElementById('start-screen').addEventListener('click', () => {
    document.getElementById('start-screen').style.display = 'none';
    orulaAudio = document.getElementById('orula-song');
    orulaAudio.volume = 0;
    orulaAudio.play();
    init();
    animate();
});

function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0xf0f0f0); // Fondo Gris muy claro

    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    document.body.appendChild(renderer.domElement);

    // --- ILUMINACI√ìN M√ÅXIMA (SIN SOMBRAS NEGRAS) ---
    const ambientLight = new THREE.AmbientLight(0xffffff, 1.0);
    scene.add(ambientLight);
    
    const topLight = new THREE.DirectionalLight(0xffffff, 0.5);
    topLight.position.set(0, 50, 0);
    scene.add(topLight);

    // --- CONSTRUCCI√ìN DE PISOS (ESCALA DE GRISES) ---
    const createFloor = (y, color) => {
        const floorGeo = new THREE.PlaneGeometry(80, 80);
        const floorMat = new THREE.MeshLambertMaterial({ color: color, side: THREE.DoubleSide });
        const floor = new THREE.Mesh(floorGeo, floorMat);
        floor.rotation.x = Math.PI / 2;
        floor.position.y = y;
        scene.add(floor);

        // Muros perimetrales grises
        const wallMat = new THREE.MeshLambertMaterial({ color: 0xdddddd });
        const wallGeo = new THREE.BoxGeometry(80, 6, 1);
        const wall = new THREE.Mesh(wallGeo, wallMat);
        wall.position.set(0, y + 3, -40);
        scene.add(wall);
    };

    createFloor(FLOORS.basement, 0xcccccc); // S√≥tano Gris medio
    createFloor(FLOORS.ground, 0xe5e5e5);   // PB Gris claro
    createFloor(FLOORS.attic, 0xffffff);    // Planta Alta Blanco

    player = new THREE.Group();
    player.position.set(0, 1.5, 15);
    scene.add(player);

    // --- V√çCTOR MENDIVIL (SPRITE) ---
    // Usamos el enlace de la imagen que proporcionaste (Placeholder representativo)
    const monsterTex = new THREE.TextureLoader().load('https://i.imgur.com/vHqLp3F.png'); 
    const monsterMat = new THREE.SpriteMaterial({ map: monsterTex });
    monster = new THREE.Sprite(monsterMat);
    monster.scale.set(4, 4, 1);
    monster.position.set(20, 1.5, -20);
    scene.add(monster);

    // --- 5 LLAVES DORADAS ---
    const keyGeo = new THREE.TorusGeometry(0.3, 0.1, 10, 20);
    const keyMat = new THREE.MeshLambertMaterial({ color: 0xffcc00 });
    const positions = [
        {x: 15, y: -9, z: 15}, {x: -25, y: 1, z: -20}, {x: 20, y: 1, z: 10}, 
        {x: -15, y: 11, z: 25}, {x: 5, y: 11, z: -15}
    ];
    positions.forEach(pos => {
        const key = new THREE.Mesh(keyGeo, keyMat);
        key.position.set(pos.x, pos.y, pos.z);
        scene.add(key);
        keys.push(key);
    });

    setupControls();
}

function setupControls() {
    const container = document.getElementById('joy-container');
    const stick = document.getElementById('joy-stick');

    container.addEventListener('touchmove', (e) => {
        const touch = e.touches[0];
        const rect = container.getBoundingClientRect();
        const dx = touch.clientX - (rect.left + rect.width/2);
        const dy = touch.clientY - (rect.top + rect.height/2);
        const angle = Math.atan2(dy, dx);
        const dist = Math.min(Math.hypot(dx, dy), 40);
        
        stick.style.transform = `translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px)`;
        moveForward = -Math.sin(angle) * (dist/40);
        moveSide = Math.cos(angle) * (dist/40);
    });

    container.addEventListener('touchend', () => {
        stick.style.transform = `translate(0,0)`;
        moveForward = 0; moveSide = 0;
    });

    document.getElementById('btn-action').addEventListener('touchstart', (e) => {
        e.preventDefault();
        interact();
    });
    document.getElementById('btn-action').addEventListener('click', interact);
}

function interact() {
    // Recoger llaves
    keys.forEach((k, i) => {
        if (player.position.distanceTo(k.position) < 3.5) {
            scene.remove(k);
            keys.splice(i, 1);
            keysCollected++;
            document.getElementById('count').innerText = keysCollected;
        }
    });

    // Escaleras (C√≠rculo central)
    if (Math.hypot(player.position.x, player.position.z) < 5) {
        if (player.position.y < 5) player.position.y += 10;
        else player.position.y = FLOORS.basement + 1.5;
        
        let piso = player.position.y < 0 ? "S√ìTANO" : (player.position.y > 5 ? "PLANTA ALTA" : "PLANTA BAJA");
        document.getElementById('floor-ui').innerText = "NIVEL: " + piso;
    }
}

function animate() {
    if (isGameOver) return;
    requestAnimationFrame(animate);

    // Movimiento suave del jugador
    player.translateZ(moveForward * PLAYER_SPEED);
    player.translateX(moveSide * PLAYER_SPEED);
    
    // C√°mara siguiendo al jugador
    camera.position.set(player.position.x, player.position.y + 1.2, player.position.z + 5);
    camera.lookAt(player.position.x, player.position.y + 0.5, player.position.z - 5);

    const dist = player.position.distanceTo(monster.position);

    // L√≥gica V√≠ctor Mendivil y Audio Din√°mico
    if (Math.abs(player.position.y - monster.position.y) < 5) {
        // El volumen de Orula aumenta con la cercan√≠a
        let volumeLevel = Math.max(0, 1 - (dist / 30));
        orulaAudio.volume = volumeLevel;
        
        document.getElementById('radar').style.display = dist < 20 ? 'block' : 'none';

        // Persecuci√≥n inteligente
        const dir = new THREE.Vector3().subVectors(player.position, monster.position).normalize();
        monster.position.add(dir.multiplyScalar(MONSTER_SPEED));
        
        if (dist < 1.8) endGame();
    } else {
        orulaAudio.volume = 0;
        document.getElementById('radar').style.display = 'none';
    }

    renderer.render(scene, camera);
}

function endGame() {
    isGameOver = true;
    orulaAudio.pause();
    document.getElementById('overlay').style.display = 'flex';
    setTimeout(() => location.reload(), 3000);
}
</script>
</body>
</html>
